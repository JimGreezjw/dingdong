window.ys={};window.ys.wechat={wxConfig:function(){var a=window.location.href;var b=a.indexOf("#");if(b>0){a=a.substring(0,b)}$.ajax({type:"GET",url:"/dingdong/ddmz/jsConfig",cache:false,data:{url:a},success:function(c){alert(JSON.stringify(c));var d=c;wx.config({debug:true,appId:d.appId,timestamp:d.timestamp,nonceStr:d.nonceStr,signature:d.signature,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","chooseImage","previewImage","uploadImage","downloadImage","chooseWXPay"]})},fail:function(c){alert(JSON.stringify(c))}});wx.checkJsApi({jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","chooseImage","previewImage","uploadImage","downloadImage","chooseWXPay"],success:function(c){alert(JSON.stringify(c))},fail:function(c){alert(JSON.stringify(c))}})},wxShare:function(a){if(!window.wx){return}ys.wechat.wxConfig();wx.ready(function(){wx.onMenuShareAppMessage(a);wx.onMenuShareTimeline(a)})},wxPay:function(){var a=localStorage.ddUserId;var b=$("#totalFee").val();$.ajax({type:"GET",url:"http://www.yushansoft.com/dingdong/ddmz/payToken",cache:false,data:{userId:a,totalFee:b},success:function(c){if(c.responseDesc=="OK"){WeixinJSBridge.invoke("getBrandWCPayRequest",c.tokenConfig,function(d){if(d.err_msg=="get_brand_wcpay_request:ok"){history.back(-1)}else{alert("微信充值失败,请稍后重试!")}})}else{}}})},wxUpload:function(){localStorage.setItem("attatchNo","");localStorage.setItem("localIds","");ys.wechat.wxConfig();wx.ready(function(){wx.chooseImage({success:function(e){var b;var f;if(e.localIds.length>5){alert("最多上传5张！")}else{var d=0;var a=e.localIds.length;var c=function(){var h=e.localIds[d];var g="#img"+d;var i=$(g);i.attr("src",h);i.show();wx.uploadImage({localId:h,isShowProgressTips:1,success:function(k){var j=k.serverId;$.ajax({url:"/dingdong/yusFiles",type:"POST",cache:"false",data:{userId:localStorage.ddUserId,wxServerId:j},success:function(l){if(1==l.responseStatus){fileId=l.yusFiles[0].id;if(b){b=b+","+fileId;f=f+","+h}else{b=fileId;f=h}d++;if(d<a){c()}else{localStorage.setItem("attatchNo",b);localStorage.setItem("localIds",f)}}else{alert(l.responseDesc)}}})}})};c()}}})})}};
